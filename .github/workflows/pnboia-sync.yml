---

3ï¸âƒ£ No campo "Name your file...", digitar EXATAMENTE:

```
.github/workflows/pnboia-sync.yml
```

IMPORTANTE: 
âœ… ComeÃ§ar com ponto (.)
âœ… Quando digitar `.github/`, o GitHub criarÃ¡ a pasta automaticamente!
âœ… Continue digitando `workflows/pnboia-sync.yml`

---

4ï¸âƒ£ Copiar e colar este cÃ³digo completo:

```yaml
name: PNBOIA Auto Sync

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CRON JOB AUTOMÃTICO - SINCRONIZAÃ‡ÃƒO PNBOIA 24/7
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
Este workflow garante que as boias PNBOIA sejam sincronizadas SEMPRE,
mesmo quando nÃ£o hÃ¡ usuÃ¡rios visitando o site.
#
FrequÃªncia: A cada 3 horas (alinhado com atualizaÃ§Ã£o das boias)
HorÃ¡rios: 00:00, 03:00, 06:00, 09:00, 12:00, 15:00, 18:00, 21:00 UTC
#
BenefÃ­cios:
- Dados sempre frescos (surfista Ã s 6 AM tem dados atualizados)
- Edge Function nunca "dorme"
- Independente de trÃ¡fego do site
- Resiliente a falhas (tenta novamente em 3h)
#
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

on:
  # Executa a cada 3 horas (cron: min hora dia mÃªs dia-da-semana)
  schedule:
cron: '0 */3 * * *'  # A cada 3 horas: 00:00, 03:00, 06:00, etc (UTC)
  
  # Permite execuÃ§Ã£o manual via GitHub UI (Ãºtil para testes)
  workflow_dispatch:

jobs:
  sync-pnboia:
    name: Sincronizar Boias PNBOIA
    runs-on: ubuntu-latest
    timeout-minutes: 5  # Timeout de 5 minutos (sincronizaÃ§Ã£o demora ~1-2 min)
    
    steps:
name: ğŸŒŠ Sincronizar todas as boias
        run: |
          echo "ğŸŒŠ Iniciando sincronizaÃ§Ã£o PNBOIA..."
          echo "â° HorÃ¡rio: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          
          # Disparar sincronizaÃ§Ã£o no servidor
          response=$(curl -X POST \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}" \
            -H "Content-Type: application/json" \
            -w "\n%{http_code}" \
            -s \
            --max-time 180 \
            "https://${{ secrets.SUPABASE_PROJECT_ID }}.supabase.co/functions/v1/make-server-2d5da22b/pnboia/sync-all?useMock=false")
          
          # Separar body e status code
          http_body=$(echo "$response" | head -n -1)
          http_code=$(echo "$response" | tail -n 1)
          
          echo "ğŸ“¥ Status HTTP: $http_code"
          echo "ğŸ“¦ Resposta: $http_body"
          
          # Verificar sucesso
          if [ "$http_code" -eq 200 ]; then
            echo "âœ… SincronizaÃ§Ã£o concluÃ­da com sucesso!"
            
            # Extrair estatÃ­sticas (se possÃ­vel)
            success_count=$(echo "$http_body" | grep -o '"success":[0-9]' | grep -o '[0-9]' || echo "?")
            total_count=$(echo "$http_body" | grep -o '"total":[0-9]' | grep -o '[0-9]' || echo "?")
            
            echo "ğŸ“Š Resultado: $success_count/$total_count boias sincronizadas"
          else
            echo "âš ï¸ SincronizaÃ§Ã£o retornou status $http_code"
            echo "â„¹ï¸ Isso pode acontecer se:"
            echo "   - Boias PNBOIA estÃ£o offline (normal)"
            echo "   - Servidor Supabase estÃ¡ lento"
            echo "   - Timeout excedido"
            echo ""
            echo "ğŸ”„ PrÃ³xima tentativa em 3 horas"
            
            # NÃ£o falhar o workflow - Ã© normal ter falhas ocasionais
            # O sistema continuarÃ¡ tentando a cada 3 horas
          fi
          
          echo ""
          echo "ğŸ¯ PrÃ³xima sincronizaÃ§Ã£o: $(date -u -d '+3 hours' '+%Y-%m-%d %H:%M:%S UTC')"

name: ğŸ“Š Verificar status das boias
        if: success() || failure()  # Sempre executar, mesmo se passo anterior falhar
        run: |
          echo ""
          echo "ğŸ” Verificando status atual das boias..."
          
          status_response=$(curl -X GET \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}" \
            -w "\n%{http_code}" \
            -s \
            --max-time 30 \
            "https://${{ secrets.SUPABASE_PROJECT_ID }}.supabase.co/functions/v1/make-server-2d5da22b/pnboia/status")
          
          status_body=$(echo "$status_response" | head -n -1)
          status_code=$(echo "$status_response" | tail -n 1)
          
          if [ "$status_code" -eq 200 ]; then
            echo "ğŸ“Š Status obtido com sucesso:"
            echo "$status_body" | python3 -m json.tool 2>/dev/null || echo "$status_body"
            
            # Extrair boias ativas
            active=$(echo "$status_body" | grep -o '"active":[0-9]' | grep -o '[0-9]' || echo "0")
            total=$(echo "$status_body" | grep -o '"total":[0-9]' | grep -o '[0-9]' || echo "14")
            
            echo ""
            echo "âœ… Boias ativas: $active/$total"
            
            if [ "$active" -ge 10 ]; then
              echo "ğŸŸ¢ Status excelente! Maioria das boias online."
            elif [ "$active" -ge 5 ]; then
              echo "ğŸŸ¡ Status bom! Algumas boias offline."
            else
              echo "ğŸ”´ Status degradado! Poucas boias online (pode ser normal Ã  noite)."
            fi
          else
            echo "âš ï¸ NÃ£o foi possÃ­vel obter status (HTTP $status_code)"
            echo "   Sistema continuarÃ¡ funcionando normalmente"
          fi

name: ğŸ“ Resumo
        if: always()  # Sempre executar
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸŒŠ RESUMO DA SINCRONIZAÃ‡ÃƒO PNBOIA"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "â° ConcluÃ­do em: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo "ğŸ”„ PrÃ³xima execuÃ§Ã£o: $(date -u -d '+3 hours' '+%H:%M UTC')"
          echo "ğŸ“… FrequÃªncia: A cada 3 horas (8x por dia)"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ’¡ DICAS:"
          echo "   â€¢ Para ver logs: GitHub â†’ Actions â†’ PNBOIA Auto Sync"
          echo "   â€¢ Para executar manualmente: Actions â†’ PNBOIA Auto Sync â†’ Run workflow"
          echo "   â€¢ Para pausar: Settings â†’ Actions â†’ Disable workflow"
          echo ""
```
